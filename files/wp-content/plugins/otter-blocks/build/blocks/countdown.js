!function(){"use strict";let t=0;class e{constructor(e){var i,n,o,s,a,d,l,r,h,c;this.id=t++,this.elem=e,this.elem.classList.add("ready");const{date:u,bhv:m,mode:v,timer:w,redirectLink:g,intvEnd:p,intvStart:S,onEndAction:b}=e.dataset;switch(this.rawData=null!=u?u:"",this.behaviour=null!==(i=m)&&void 0!==i?i:"default",this.mode=v,this.timer=null!=w?w:"0",this.redirectLink=g,this.startInterval=S,this.endInterval=p,this.hideTime=0,this.onEndAction=b,this.oneTimeRun={hideOrShow:!1},this.currentTime=Date.now(),this.components={},["second","minute","hour","day"].forEach((t=>{const i=e.querySelector(`div[name=${t}]`);if(i){const e=i.querySelector(".otter-countdown__label"),n=i.querySelector(".otter-countdown__value");this.components[t]={label:null!=e?e:void 0,value:null!=n?n:void 0}}})),this.onEndEvents=[()=>this.activateBehaviour(),()=>this.activateActions()],this.mode){case"timer":const t=localStorage.getItem(`o-countdown-last-visit-${this.elem.id}`),e=localStorage.getItem(`o-countdown-last-visit-time-${this.elem.id}`);(!t||parseInt(t)+parseInt(this.timer)-Date.now()>2592e6||e!==this.timer)&&(localStorage.setItem(`o-countdown-last-visit-${this.elem.id}`,Date.now().toString()),localStorage.setItem(`o-countdown-last-visit-time-${this.elem.id}`,this.timer)),this.targetDate=parseInt(localStorage.getItem(`o-countdown-last-visit-${this.elem.id}`))+parseInt(this.timer),this.canRestart&&(localStorage.setItem(`o-countdown-last-visit-${this.elem.id}`,Date.now().toString()),this.targetDate=parseInt(localStorage.getItem(`o-countdown-last-visit-${this.elem.id}`))+parseInt(this.timer));break;case"interval":this.targetDate=this.endInterval?new Date(this.endInterval+(null!==(n=null===(o=window)||void 0===o||null===(s=o.themeisleGutenbergCountdown)||void 0===s?void 0:s.timezone)&&void 0!==n?n:"")).getTime():0,this.hideTime=this.startInterval?new Date(this.startInterval+(null!==(a=null===(d=window)||void 0===d||null===(l=d.themeisleGutenbergCountdown)||void 0===l?void 0:l.timezone)&&void 0!==a?a:"")).getTime():0;break;default:this.targetDate=this.rawData?new Date(this.rawData+(null!==(r=null===(h=window)||void 0===h||null===(c=h.themeisleGutenbergCountdown)||void 0===c?void 0:c.timezone)&&void 0!==r?r:"")).getTime():Date.now()}this.hideOrShow(this.isStopped&&"hide"===this.behaviour||this.mustBeHidden)}update(t){"interval"!==this.mode||this.oneTimeRun.hideOrShow||this.hideOrShow(this.mustBeHidden),t.forEach((t=>{var e,i,n,o,s,a,d;null!==(e=this.components)&&void 0!==e&&null!==(i=e[t.tag])&&void 0!==i&&i.label&&(null===(n=this.components[t.tag])||void 0===n||null===(o=n.label)||void 0===o?void 0:o.innerHTML)!==t.label&&(this.components[t.tag].label.innerHTML=null!==(d=t.label)&&void 0!==d?d:""),null!==(s=this.components)&&void 0!==s&&null!==(a=s[t.tag])&&void 0!==a&&a.value&&(this.components[t.tag].value.innerHTML=t.value)}))}onEnd(t){this.onEndEvents.push(t)}end(){const t=new CustomEvent("o-countdown-stop",{bubbles:!0,detail:{countdown:this}});this.elem.dispatchEvent(t),this.onEndEvents.forEach((t=>t()))}activateBehaviour(){switch(this.behaviour){case"default":break;case"hide":this.hide();break;case"redirectLink":this.redirectLink&&window.location.replace(this.redirectLink)}}activateActions(){const t=this.connectedBlocksSelector;t&&"all"===this.onEndAction&&(document.querySelectorAll(`${t}.o-cntdn-bhv-hide`).forEach((t=>t.classList.add("o-cntdn-hide"))),document.querySelectorAll(`${t}.o-cntdn-bhv-show`).forEach((t=>t.classList.remove("o-cntdn-bhv-show"))))}hideOrShow(t){t?this.hide():(this.oneTimeRun.hideOrShow=!0,this.show(),document.querySelectorAll(`${this.connectedBlocksSelector}.o-cntdn-bhv-hide`).forEach((t=>{t.classList.add("o-cntdn-ready")})))}hide(){this.elem.classList.add("o-hide")}show(){this.elem.classList.add("o-cntdn-ready"),this.elem.classList.remove("o-hide")}get connectedBlocksSelector(){return void 0===this.elem.id?null:`.o-countdown-trigger-on-end-${this.elem.id.split("-").pop()}`}get remainingTime(){return this.targetDate-this.currentTime}get isStopped(){return 0>=this.remainingTime}get mustBeHidden(){return void 0!==this.startInterval&&0<=this.hideTime-this.currentTime}get canRestart(){return"restart"===this.behaviour&&"timer"===this.mode&&this.isStopped}set time(t){this.currentTime=t}}class i{constructor(){this.countdowns={},this.running=new Set,this.stopped=new Set}register(t){t&&(t.onEnd((()=>{this.running.delete(t.id),this.stopped.add(t.id)})),this.countdowns[t.id]=t,this.running.add(t.id))}startTimer(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300;this.timer=setInterval((()=>{const t=Date.now();this.running.forEach((e=>{this.updateCountdown(this.countdowns[e],t)})),0===this.running.size&&this.stopTimer()}),t)}stopTimer(){clearInterval(this.timer)}updateCountdown(t,e){const{id:i}=t;t.time=e;try{const{remainingTime:e}=t,i=Math.floor(e/864e5),n=Math.floor(e/36e5%24),o=Math.floor(e/6e4%60),s=Math.floor(e/1e3%60),{i18n:a}=window.themeisleGutenbergCountdown,d=[{tag:"day",label:1<i?a.days:a.day,value:i},{tag:"hour",label:1<n?a.hours:a.hour,value:n},{tag:"minute",label:1<o?a.minutes:a.minute,value:o},{tag:"second",label:1<s?a.seconds:a.second,value:s}].filter((e=>{var i,n;let{tag:o}=e;return!(null!==(i=t.settings)&&void 0!==i&&null!==(n=i.exclude)&&void 0!==n&&n.includes(o))})).map((e=>{var i;return{...e,value:null!==(i=t.settings)&&void 0!==i&&i.keepNeg?e.value.toString():Math.max(0,e.value).toString()}}));t.update(d),t.isStopped&&t.end()}catch(t){console.error(t),this.running.delete(i)}}}var n;n=()=>{const t=document.querySelectorAll(".wp-block-themeisle-blocks-countdown"),n=new i;t.forEach((t=>{const i=new e(t);n.register(i)})),n.startTimer()},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",n):n())}();